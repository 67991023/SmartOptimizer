<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SmartData Optimizer | AI-Powered Data Pipeline</title>

<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
:root{
--primary:#4F46E5;
--primary-hover:#4338CA;
--bg-body:#F9FAFB;
--bg-card:#FFFFFF;
--text-main:#111827;
--text-muted:#6B7280;
--border:#E5E7EB;
--radius:12px;
}

*{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Inter',sans-serif;background:var(--bg-body);color:var(--text-main)}

.navbar{
background:var(--bg-card);
border-bottom:1px solid var(--border);
padding:1rem 2rem;
display:flex;
justify-content:space-between;
align-items:center;
position:sticky;
top:0;
}

.logo{font-weight:700;font-size:1.25rem;color:var(--primary)}

.container{max-width:1100px;margin:2rem auto;padding:0 1rem}

.workflow-grid{display:grid;grid-template-columns:350px 1fr;gap:2rem}

.card{
background:var(--bg-card);
border:1px solid var(--border);
border-radius:var(--radius);
padding:1.5rem;
margin-bottom:1.5rem;
box-shadow:0 1px 3px rgba(0,0,0,0.1);
}

.card-title{
font-weight:600;
margin-bottom:1rem;
display:flex;
align-items:center;
gap:10px;
}

.upload-zone{
border:2px dashed var(--border);
border-radius:var(--radius);
padding:2rem;
text-align:center;
cursor:pointer;
}

.upload-zone:hover{
border-color:var(--primary);
background:#F5F3FF;
}

.btn{
border:none;
border-radius:8px;
padding:.6rem 1.2rem;
font-weight:500;
cursor:pointer;
display:inline-flex;
align-items:center;
gap:8px;
font-size:.9rem;
}

.btn-primary{background:var(--primary);color:white}
.btn-primary:hover{background:var(--primary-hover)}

.btn-outline{
background:transparent;
border:1px solid var(--border);
}

.btn-outline:hover{background:#f3f4f6}
.btn:disabled{opacity:.5;cursor:not-allowed}

.table-container{
overflow-x:auto;
margin-top:1rem;
border-radius:8px;
border:1px solid var(--border);
}

table{width:100%;border-collapse:collapse;font-size:.85rem}
th{background:#F9FAFB;padding:10px;text-align:left;border-bottom:1px solid var(--border)}
td{padding:10px;border-bottom:1px solid var(--border)}

#console{
background:#111827;
color:#10B981;
padding:1rem;
border-radius:8px;
font-family:monospace;
font-size:.8rem;
height:150px;
overflow-y:auto;
margin-top:1rem;
}

.hidden{display:none}
</style>
</head>
<body>

<nav class="navbar">
<div class="logo"><i class="fas fa-microchip"></i> SmartData Optimizer</div>
<div id="session-badge" class="hidden">
<span id="session-id-display">Session</span>
</div>
</nav>

<div class="container">
<div class="workflow-grid">

<!-- LEFT -->
<aside>

<div class="card">
<div class="card-title">1. Import Data</div>

<input type="file" id="fileInput" class="hidden" accept=".csv,.json">

<div class="upload-zone" onclick="fileInput.click()">
<p id="file-name">Click to upload CSV or JSON</p>
</div>

<button class="btn btn-primary" onclick="uploadFile()" style="width:100%;margin-top:1rem">
Upload & Initialize
</button>
</div>


<div class="card">
<div class="card-title">2. Actions</div>

<div style="display:flex;flex-direction:column;gap:10px">

<button id="btn-scan" class="btn btn-outline" onclick="scanData()" disabled>
Run Health Scan
</button>

<button id="btn-clean" class="btn btn-outline" onclick="autoClean()" disabled>
Auto-Optimize Data
</button>

<button id="btn-undo" class="btn btn-outline" onclick="undoAction()" disabled>
Undo Last Step
</button>

<button id="btn-export" class="btn btn-outline" onclick="exportData()" disabled>
Export Optimized Data
</button>

</div>
</div>


<div class="card">
<div class="card-title">3. Machine Learning</div>

<input id="target-col" placeholder="Target column" style="width:100%;padding:8px;margin-bottom:1rem">

<select id="model-type" style="width:100%;padding:8px;margin-bottom:1rem">
<option value="linear_regression">Linear Regression</option>
<option value="random_forest_reg">Random Forest Regressor</option>
<option value="logistic_regression">Logistic Regression</option>
<option value="random_forest_clf">Random Forest Classifier</option>
</select>

<button id="btn-train" class="btn btn-primary" onclick="trainModel()" style="width:100%" disabled>
Train & Evaluate
</button>

</div>

</aside>


<!-- RIGHT -->
<main>

<div class="card" style="min-height:400px">
<div class="card-title">Data Preview</div>

<div id="empty-state" style="text-align:center;padding:4rem;color:gray">
No data loaded
</div>

<div id="data-content" class="hidden">
<div class="table-container">
<table id="preview-table"></table>
</div>
</div>

</div>

<div class="card">
<div class="card-title">System Logs</div>
<div id="console">> Ready...</div>
</div>

</main>

</div>
</div>


<script>
const API_BASE="http://localhost:8000";
let currentSessionId="";

/* LOG FUNCTION (ปรับเวลาใหม่) */
function log(message){
const now=new Date();
const time=now.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
const el=document.getElementById("console");
el.innerHTML+=`<div><span style="color:#6B7280;font-size:.7rem">[${time}]</span> ${message}</div>`;
el.scrollTop=el.scrollHeight;
}


/* UPLOAD */
async function uploadFile(){
const file=fileInput.files[0];
if(!file)return alert("Select file");

const form=new FormData();
form.append("file",file);

log("Uploading dataset...");

const res=await fetch(`${API_BASE}/upload`,{method:"POST",body:form});
const data=await res.json();

currentSessionId=data.session_id;

sessionBadge.classList.remove("hidden");
sessionIdDisplay.innerText="ID: "+currentSessionId.slice(0,8);

btnScan.disabled=false;
btnTrain.disabled=false;

updateUI(data.preview);
log("Upload success");
}


/* SCAN */
async function scanData(){
log("Scanning...");
const r=await fetch(`${API_BASE}/scan/${currentSessionId}`);
await r.json();
btnClean.disabled=false;
log("Scan complete");
}


/* CLEAN */
async function autoClean(){
log("Optimizing...");
const r=await fetch(`${API_BASE}/auto-clean/${currentSessionId}`,{method:"POST"});
const d=await r.json();

updateUI(d.preview);

btnUndo.disabled=false;
btnExport.disabled=false;

log("Optimization complete");
}


/* UNDO */
async function undoAction(){
const r=await fetch(`${API_BASE}/undo/${currentSessionId}`,{method:"POST"});
const d=await r.json();
updateUI(d.preview);
log("Undo done");
}


/* EXPORT */
async function exportData(){
log("Preparing export...");
const res=await fetch(`${API_BASE}/export/${currentSessionId}`);
const blob=await res.blob();

const url=URL.createObjectURL(blob);
const a=document.createElement("a");
a.href=url;
a.download="optimized_data.csv";
a.click();
a.remove();

log("Export complete");
}


/* TRAIN */
async function trainModel(){
const target=document.getElementById("target-col").value;
const type=document.getElementById("model-type").value;
if(!target)return alert("Enter target column");

log("Training model...");

const r=await fetch(`${API_BASE}/train`,{
method:"POST",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({
session_id:currentSessionId,
target_column:target,
model_type:type
})
});

const d=await r.json();

if(d.status==="success")
log("Score: "+(d.metrics.accuracy||d.metrics.r2_score).toFixed(4));
else
log("Error");
}


/* TABLE */
function updateUI(data){
emptyState.classList.add("hidden");
dataContent.classList.remove("hidden");

if(!data.length)return;

let html="<thead><tr>";
Object.keys(data[0]).forEach(k=>html+=`<th>${k}</th>`);
html+="</tr></thead><tbody>";

data.forEach(r=>{
html+="<tr>";
Object.values(r).forEach(v=>html+=`<td>${v}</td>`);
html+="</tr>";
});

html+="</tbody>";
previewTable.innerHTML=html;
}


/* FILE NAME */
fileInput.addEventListener("change",()=>{
if(fileInput.files[0])
fileName.innerText=fileInput.files[0].name;
});
</script>

</body>
</html>
